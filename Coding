CREATE DATABASE sequencing;

USE sequencing;

CREATE TABLE dna
(dna_id varchar (6) not null,
dna_sequence varchar(255) not null,
mutation varchar(20) not null,
error_type varchar(20) not null,
position int(255) not null,
PRIMARY KEY (dna_id)
);

INSERT INTO dna
(dna_id, dna_sequence, mutation, error_type, position)
VALUES
("D0001","CGGACAGGACTATATACTTGGGTTTGATCTCGCCCCGACAACTGCAAACCTCAACTTTTTTAGATTATATGGTTAGCCGAAGTTGCACGAGGTGGCGTCCGCGGACTGCTCCCCGAGTGTGGCTCTTTCATCTGACAACGTGCAACCCCTATCGCGGCCGATTGTTTCTGCGGACGATGTTGTCCTCATAGTTTGGGCAT","A>G","substitution","16"),
("D0002","GTTTCCCTTGTAGGTGTGAAACCACTTAGCTTCGCGCCGTAGTCCCAATGAAAAACCTATGGACTTTGTTTTGGGTAGCACCAGGAATCTGAACCGTGTGAATGTGGACGTCGCGCGCGTAGACCTTTATCTCCGGTTCAAGCTAGGGATGTGGCTGCATGCTACGTTGTCACACCTACACTGCTCGAAGTAAATATGCG","TA>T","deletion","18"),
("D0003","AAGCGCGCGGCCTGGCCGGAGGCGTTCCGCGCCGCCACGTGTTCGTTAACTGTTGATTGGTGGCACATAAGCAATATCGTAGTCCGTCAAATTCAGCTCTGTTATCCCGGGCGTTATGTGTCAAATGGCGTAGAACGGGATTGACTGTTTGACGGTAGCTGCTGATCGGTACGGTAACGGAGAATCTGTCGGGCTATGTC","C>T","substitution","127"),
("D0004","ACTAATACTTTCCAAACGCCCCGTACCGATGCTGAACAAGTCGATGCAGGCTCCCGTCTTTGAAAAGGGGTAAACATACAAGTGGATAGATGATGGGTAGGGGCCTCCAATACATCCAACACTCTACGCCCTCTCCAAGAGCTAGAAGGGCACCCTGCAGTTGGAAAGGGAACTATTTCGTAAGGCGAGCCCATACCGTC","G>C","substitution","110"),
("D0005","ACTCATGCGGAAGACTTAACACGATAGGAAGCAGGAATAGTTTCGAACGACGGTTATTAATCCTAATAACGGAACGCTGTCTGAAGGATGAGTGTGAGGGAGTGTAACTCGATGAGCTACCCGGTAATCGAACTGGGCGAGACATCCCAGCGCTGATGCACTCAATCCCGAGGCCTGACCCGACATATCAGCTTAGACTA","A>G","substitution","36"),
("D0006","GAGCGGGGCTGTTGACGTTTGGGGTTGAATAAATCTATTGTACCAATCGGCTTCAACGTGCCCCACGGGTGGCACCTGAGGAGGGGCCCACACCGAGGAAGTAGACTGTTATACGTCGGCGATGGTGGTAGCTAACTATGTTGCCTGCCACTACAACAGTATCTAAGCCGTGTAAAGGGAACATCCACACTTTAGTGAAT","A>TA","insertion","109"),
("D0007","CGAAGCGCGGCTTCAGAATACCGTTTTGGCTACCTGATACAAAGCCCATCGTGGTCCTCAGATATCGTGCACGTAGAGTTGCACCGCACGCATGTGGAATTAGTGGCGAAGTACGATTCCAAGACCGACGTACGATACAACTATGCGGATGTGACGAGCTTCTTTTATATGCTTCGCCCGCCGGACCGGCCTCGTGATGG","G>T","substitution","62"),
("D0008","CGTAGCTGCGCATAAGCAAATGACAATTAACGAGTGTGTACTCGTTTTATCATCTGGCAGTTAAAGTCGGGAGAATAGGAGCCGCAACACACAGTTTACCGCATCTAGACCTAACTGAGATACTGCCATAGACGACTAGCCATCCCTCTGGCTCTTAGATAGCCGGATACAGTGATTTTGAAAGGTTTGTGGGGTACAGC","AA>A","deletion","87"),
("D0009","TATGACTTGCTTAGCTGCGTGTGAGGGAAGGAACTTTTGCGTGTTAGTATGTTGACCCGTGTACTACGCATGCGGGTAGATTATGTAGGTTGAGAGATGCAGGAGAAGTTCTCGACCTTCCCGTGGGAGGTGAACCTATTCACTATTGGAGCATTCCGTTCGAGCATGGCAGTAAGTACGCCTTCTCCATTCTGGTAACC","T>CT","insertion","78"),
("D0010","TTCATCCCTATCAGAGCTTGGAGCCAATGATCAGGGTTATTCCCTTGGGACAGACTTCCTACTCACAGTCGGTCACATTGGGCTACTCCATGGGTCTTCGGCTTGACCCGGTCTGTTGGGCCGCGATTGCGTGAGTTTCGGCCCCGCGCTGCGCTGTATAGTCGATTCTCATCCGGCCCTCACATCTGGAAACCCCAACT","CA>A","deletion","90"),
("D0011","TATTTAGATAACATCATTAGCCGAAGTTGCTGGGCATGTCCACCGTGGAGTCCTCCCCGGGCGTCCCTCCTTCAAATGACGATAAGCACCGGCAAGCACCATTGATCAACGCAAGGATCGGTGATGTTAACAAAGATTCGGCACATTACTCTTGTTGGTGTGGAATCGCTTAACTACGCGGCGAAGCCTTATGGCAAAAC","TTA>A","deletion","173");

SELECT *
FROM dna;

USE sequencing;
CREATE TABLE protein
(prot_id varchar(6) not null,
dna_id varchar(6) not null,
aa_sequence varchar(255) not null,
consequence varchar(20) not null,
position int(255) not null,
PRIMARY KEY (prot_id),
FOREIGN KEY (dna_id) REFERENCES dna(dna_id));

INSERT INTO protein
(prot_id, dna_id, aa_sequence, consequence, position)
VALUES
("PR0001","D0001","MVLMAGYPAGEIILELARRTGVDMYAVHFPSGTFPFLRDNVLPLVERQYGSQRCTVKIYGATIRCVKTDPGETRMSYDVL","frameshift","60"),
("PR0002","D0003","MIADHILTMKFIATNGADALHHLTTRMVNIVQAPTIQSTEGIYCEAPFSEEQQGPANGIEDMGTAAASCKPTDSITEVKE","stop_gained","18"),
("PR0003","D0004","MDGDIQGRAHEVQIWALYDGGGYAKPVDESIVEFYPGEIEMLSNAGIRKRVMLEKFDPQDQLRIIKEIQLKSAANFEVTF","missense","22"),
("PR0004","D0008","MAASASFLTPTGNSPAKSTKAHQLVAVTTLYQDMVEFGGAVFTAVKIRSIQQEQIATDQGLSKLGIDQIFVPAQSENARK","missense","75"),
("PR0005","D0009","MYVAAAVGKVSSGNALPLIIYNKLGELYDINANSKASPIGLRARSCVEEFLLDVDKLIVVLVTDHVRGLNTNSYETNVVY","frameshift","22"),
("PR0006","D0010","TRKMALPGGQAVEVTDQLSKCPRRMSTLSCRKRVGLGKSLKFPKDESDLCVTLLELRLYRPVNVKQLALAQIYPEKDAL","synonymous","45");

SELECT *
FROM protein;

USE sequencing;
CREATE TABLE sequence
(dna_id varchar(6) not null,
type_of_seq varchar(25) not null,
date_of_seq varchar(20) not null,
quality int(8) not null,
FOREIGN KEY (dna_id) REFERENCES dna(dna_id));

INSERT INTO sequence
(dna_id, type_of_seq, date_of_seq, quality)
VALUES
("D0001","Illumina","02-10-2023",58),
("D0002","ONT","02-11-2023",62),
("D0003","Illumina","05-10-2023",78),
("D0004","Illumina","08-10-2023",98),
("D0005","ONT","09-10-2023",88),
("D0006","ONT","10-10-2023",77),
("D0007","ONT","21-10-2023",98),
("D0008","Sanger","08-10-2023",95),
("D0009","ONT","10-10-2023",97),
("D0010","Illumina","02-10-2023",70),
("D0011","Illumina","02-11-2023",84),
("D0005","Illumina","09-10-2023",95),
("D0006","Illumina","10-10-2023",97);

SELECT *
FROM sequence;

USE sequencing;
CREATE TABLE researchers
(res_id varchar(6) not null,
first_name varchar(15) not null,
last_name varchar(20) not null,
job_title varchar(50) not null,
PRIMARY KEY (res_id)
);

INSERT INTO researchers
(res_id, first_name, last_name, job_title)
VALUES
("R0001", "Mary" , "Alley", "Senior Process Scientist"),
("R0002", "John" , "Green", "Molecular Biologist"),
("R0003", "Michael" , "Brown", "Sequencing Technician");

SELECT *
FROM researchers;

USE sequencing;
CREATE TABLE experiments
(exp_id varchar(6) not null,
date_of_exp varchar(15) not null,
res_id varchar(20) not null,
dna_id varchar(20) not null,
PRIMARY KEY (exp_id), 
FOREIGN KEY (res_id) REFERENCES researchers(res_id),
FOREIGN KEY (dna_id) REFERENCES dna(dna_id)
);

INSERT INTO experiments
(exp_id, date_of_exp, res_id, dna_id)
VALUES
("EX0001", "01-11-2023" , "R0001", "D0001"),
("EX0002", "03-11-2023" , "R0001", "D0004"),
("EX0003", "05-11-2023" , "R0002", "D0009"),
("EX0004", "12-11-2023" , "R0003", "D0008"),
("EX0005", "10-11-2023" , "R0002", "D0003");

SELECT dna.dna_id, dna.error_type, protein.consequence
FROM dna
INNER JOIN protein
ON dna.dna_id = protein.dna_id;



USE sequencing;
DELIMITER //

CREATE FUNCTION get_sequence_quality(quality int(8)) 
RETURNS varchar(20)
BEGIN
DECLARE qual_type varchar(20);
	IF quality <= 30 THEN
		SET qual_type = "Low";
	ELSEIF quality <= 70 THEN 
		SET qual_type = "Good";
	ELSE
		SET qual_type = "Excellent";
	END IF;
RETURN qual_type;
END //

DELIMITER ;


SELECT quality, get_sequence_quality(quality) FROM sequence;


USE sequencing;
SELECT * 
FROM experiments
WHERE dna_id = (SELECT protein.dna_id FROM protein WHERE consequence = 'stop_gained');
